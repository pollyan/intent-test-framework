<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½æ¼”ç¤º - æ™ºèƒ½åŠ©æ‰‹</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "PingFang SC", "Microsoft YaHei", sans-serif;
            background-color: #f5f5f5;
            color: #333333;
            line-height: 1.6;
        }

        .container {
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: #ffffff;
            border: 1px solid #e8e8e8;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .header h1 {
            color: #333333;
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .header p {
            color: #666666;
            font-size: 14px;
        }

        /* é‡‡ç”¨çœŸå®é¡µé¢çš„æ¡Œé¢ç«¯å¸ƒå±€ */
        .desktop-layout {
            --dynamic-height: calc(100vh - 180px);
            display: flex;
            flex-direction: row;
            height: var(--dynamic-height);
            padding: 0 20px 20px 20px;
            box-sizing: border-box;
            width: 100vw;
            margin-left: calc(50% - 50vw);
            overflow: hidden;
        }

        .chat-panel {
            width: 600px;
            flex: none;
            display: flex;
            flex-direction: column;
            min-width: 300px;
        }

        .resize-handle {
            width: 12px;
            background: transparent;
            cursor: col-resize;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: all 0.2s ease;
        }

        .resize-handle:hover {
            background: rgba(0, 0, 0, 0.05);
        }

        .resize-handle-line {
            width: 1px;
            height: 60%;
            background: #d0d0d0;
            transition: all 0.2s ease;
        }

        .analysis-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-width: 300px;
            width: 0;
        }

        .chat-container {
            display: flex;
            flex-direction: column;
            background: #ffffff;
            border: 1px solid #e8e8e8;
            border-radius: 8px;
            height: 100%;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .chat-header {
            padding: 16px 20px;
            border-bottom: 1px solid #e8e8e8;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f8f8f8;
        }

        .chat-title {
            font-size: 15px;
            font-weight: 600;
            color: #333333;
        }

        .chat-status {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #28a745;
        }

        .status-text {
            font-size: 13px;
            color: #666666;
        }

        .messages-area {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 16px;
            min-height: 400px;
            position: relative;
        }

        .message {
            display: flex;
            gap: 12px;
            max-width: 80%;
        }

        .message.user {
            align-self: flex-end;
            flex-direction: row-reverse;
        }

        .message.assistant {
            align-self: flex-start;
        }

        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 500;
            flex-shrink: 0;
        }

        .message.user .message-avatar {
            background: #333333;
            color: white;
        }

        .message.assistant .message-avatar {
            background: #f0f0f0;
            color: #666666;
        }

        .message-content {
            padding: 12px 16px;
            border-radius: 8px;
            line-height: 1.5;
            font-size: 14px;
        }

        .message.user .message-content {
            background: #f0f0f0;
            color: #333333;
        }

        .message.assistant .message-content {
            background: #ffffff;
            border: 1px solid #e8e8e8;
            color: #333333;
        }

        .message-time {
            font-size: 12px;
            color: #999999;
            margin-top: 4px;
        }

        /* æ–‡ä»¶é™„ä»¶æ ·å¼ */
        .file-attachments {
            margin-top: 8px;
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .file-attachment {
            display: flex;
            align-items: center;
            gap: 6px;
            background: rgba(0, 0, 0, 0.05);
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .message.assistant .file-attachment {
            background: #f0f0f0;
            border: 1px solid #e8e8e8;
            color: #666666;
        }

        .file-icon {
            width: 12px;
            height: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
        }

        .file-name {
            font-weight: 500;
            max-width: 100px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .file-size {
            opacity: 0.7;
            font-size: 11px;
        }

        /* ä¸Šä¼ è¿›åº¦æ ·å¼ */
        .upload-progress {
            margin-top: 8px;
            background: rgba(0, 0, 0, 0.05);
            border-radius: 6px;
            padding: 8px 12px;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .upload-progress-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 6px;
        }

        .upload-filename {
            font-size: 12px;
            font-weight: 500;
            color: #333333;
        }

        .upload-status {
            font-size: 11px;
            color: #666666;
        }

        .progress-bar {
            height: 3px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 2px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: #333333;
            border-radius: 2px;
            transition: width 0.3s ease;
        }

        .input-area {
            padding: 20px;
            border-top: 1px solid #e8e8e8;
            background: #f8f8f8;
        }

        .input-form {
            display: flex;
            gap: 12px;
            align-items: flex-start;
        }

        .input-wrapper {
            flex: 1;
            position: relative;
        }

        .message-input {
            width: 100%;
            min-height: 44px;
            max-height: 200px;
            padding: 12px 90px 12px 16px;
            border: 1px solid #e8e8e8;
            border-radius: 20px;
            background: #ffffff;
            resize: none;
            font-size: 14px;
            line-height: 1.4;
            font-family: inherit;
            transition: border-color 0.2s ease;
            box-sizing: border-box;
        }

        .message-input:focus {
            outline: none;
            border-color: #333333;
        }

        .message-input.drag-over {
            border-color: #28a745;
            background: #f8fff9;
        }

        .message-input::placeholder {
            color: #999999;
        }

        .input-actions {
            position: absolute;
            top: 50%;
            right: 12px;
            transform: translateY(-50%);
            display: flex;
            gap: 4px;
            align-items: center;
        }

        .upload-btn {
            width: 32px;
            height: 32px;
            border: none;
            border-radius: 50%;
            background: #f0f0f0;
            color: #666666;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            font-size: 14px;
        }

        .upload-btn:hover {
            background: #e8e8e8;
            color: #333333;
        }

        .char-counter {
            font-size: 12px;
            color: #999999;
            white-space: nowrap;
        }

        .send-btn {
            padding: 12px 20px;
            background: #333333;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
            height: 44px;
            min-width: 80px;
            align-self: flex-start;
            flex-shrink: 0;
        }

        .send-btn:hover:not(:disabled) {
            background: #555555;
        }

        .send-btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
        }

        .hidden-file-input {
            display: none;
        }

        /* æ‹–æ‹½è¦†ç›–å±‚ */
        .drag-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(40, 167, 69, 0.1);
            border: 2px dashed #28a745;
            border-radius: 20px;
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 8px;
            z-index: 10;
        }

        .drag-overlay.active {
            display: flex;
        }

        .drag-text {
            color: #28a745;
            font-size: 14px;
            font-weight: 600;
        }

        .drag-subtext {
            color: #666666;
            font-size: 12px;
        }

        /* é™„ä»¶é¢„è§ˆåŒºåŸŸ */
        .attachment-preview {
            margin-bottom: 12px;
            padding: 8px 12px;
            background: #f8f8f8;
            border-radius: 8px;
            border: 1px solid #e8e8e8;
            display: none;
        }

        .attachment-preview.visible {
            display: block;
        }

        .attachment-list {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .attachment-item {
            display: flex;
            align-items: center;
            gap: 6px;
            background: #ffffff;
            padding: 6px 10px;
            border-radius: 6px;
            border: 1px solid #e8e8e8;
            font-size: 12px;
        }

        .attachment-icon {
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #333333;
            color: white;
            border-radius: 3px;
            font-size: 9px;
            font-weight: 600;
        }

        .attachment-info {
            display: flex;
            flex-direction: column;
            gap: 1px;
        }

        .attachment-name {
            color: #333333;
            font-weight: 500;
        }

        .attachment-size {
            color: #666666;
            font-size: 10px;
        }

        .remove-attachment {
            width: 14px;
            height: 14px;
            border: none;
            background: #f0f0f0;
            color: #999999;
            border-radius: 50%;
            cursor: pointer;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .remove-attachment:hover {
            background: #ffebee;
            color: #d32f2f;
        }

        /* å³ä¾§åˆ†æé¢æ¿ */
        .consensus-container {
            display: flex;
            flex-direction: column;
            background: #ffffff;
            border: 1px solid #e8e8e8;
            border-radius: 8px;
            height: 100%;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .consensus-header {
            padding: 16px 20px;
            border-bottom: 1px solid #e8e8e8;
            background: #f8f8f8;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .consensus-title {
            font-size: 16px;
            font-weight: 600;
            color: #333333;
        }

        .consensus-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #999999;
        }

        /* åŠŸèƒ½è¯´æ˜åŒºåŸŸ */
        .features-section {
            background: #ffffff;
            border: 1px solid #e8e8e8;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 20px;
            margin-top: 20px;
        }

        .features-title {
            font-size: 16px;
            font-weight: 600;
            color: #333333;
            margin-bottom: 16px;
        }

        .feature-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .feature-item {
            display: flex;
            gap: 10px;
            padding: 12px;
            background: #f8f8f8;
            border-radius: 6px;
            margin-bottom: 8px;
        }

        .feature-icon {
            width: 20px;
            height: 20px;
            background: #333333;
            color: white;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            flex-shrink: 0;
        }

        .feature-content {
            flex: 1;
        }

        .feature-name {
            font-size: 13px;
            font-weight: 600;
            color: #333333;
            margin-bottom: 2px;
        }

        .feature-desc {
            font-size: 12px;
            color: #666666;
            line-height: 1.3;
        }

        .supported-formats {
            margin-top: 16px;
            padding: 12px;
            background: #f0f8ff;
            border-radius: 6px;
            border: 1px solid #d0e7ff;
        }

        .formats-title {
            font-size: 13px;
            font-weight: 600;
            color: #1565c0;
            margin-bottom: 6px;
        }

        .formats-list {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
        }

        .format-tag {
            background: #e3f2fd;
            color: #0d47a1;
            padding: 3px 6px;
            border-radius: 3px;
            font-size: 11px;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- é¡µé¢æ ‡é¢˜ -->
        <div class="header">
            <h1>æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½æ¼”ç¤º</h1>
            <p>åœ¨æ™ºèƒ½åŠ©æ‰‹ä¸­æ·»åŠ æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼Œæ”¯æŒ txt å’Œ md æ ¼å¼</p>
        </div>

        <!-- æ¡é¢ç«¯å¸ƒå±€ -->
        <div class="desktop-layout">
            <!-- å·¦ä¾§ï¼šå¯¹è¯åŒºåŸŸ -->
            <div class="chat-panel">
                <div class="chat-container">
                    <div class="chat-header">
                        <div class="chat-title">ä¸Alex Chenå¯¹è¯</div>
                        <div class="chat-status">
                            <div class="status-dot"></div>
                            <span class="status-text">å·²è¿æ¥</span>
                        </div>
                    </div>

                    <div class="messages-area" id="messagesArea">
                        <div class="message assistant">
                            <div class="message-avatar">A</div>
                            <div class="message-content">
                                æ‚¨å¥½ï¼æˆ‘æ˜¯Alex Chenï¼Œä¸“ä¸šçš„éœ€æ±‚åˆ†æå¸ˆã€‚æ‚¨å¯ä»¥ä¸Šä¼  txt æˆ– md æ ¼å¼çš„éœ€æ±‚æ–‡æ¡£ï¼Œæˆ‘ä¼šåŸºäºæ–‡æ¡£å†…å®¹ä¸ºæ‚¨æä¾›æ›´å‡†ç¡®çš„éœ€æ±‚åˆ†æã€‚
                            </div>
                            <div class="message-time">åˆšåˆš</div>
                        </div>
                    </div>

                    <div class="input-area">
                        <!-- æ‹–æ‹½è¦†ç›–å±‚ -->
                        <div class="drag-overlay" id="dragOverlay">
                            <div class="drag-text">ğŸ“ é‡Šæ”¾æ–‡ä»¶è¿›è¡Œä¸Šä¼ </div>
                            <div class="drag-subtext">æ”¯æŒ txt, md æ–‡æ¡£æ ¼å¼</div>
                        </div>

                        <!-- é™„ä»¶é¢„è§ˆåŒºåŸŸ -->
                        <div class="attachment-preview" id="attachmentPreview">
                            <div class="attachment-list" id="attachmentList">
                                <!-- é™„ä»¶é¡¹å°†åŠ¨æ€æ·»åŠ åˆ°è¿™é‡Œ -->
                            </div>
                        </div>

                        <form class="input-form" id="messageForm">
                            <div class="input-wrapper">
                                <textarea 
                                    class="message-input" 
                                    id="messageInput" 
                                    placeholder="è¯·è¾“å…¥æ‚¨çš„éœ€æ±‚æˆ–é—®é¢˜ï¼Œä¹Ÿå¯ä»¥ç›´æ¥æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„ä¸Šä¼ ..." 
                                    rows="1"
                                ></textarea>
                                
                                <div class="input-actions">
                                    <button type="button" class="upload-btn" onclick="triggerFileUpload()" title="ä¸Šä¼ æ–‡ä»¶">
                                        ğŸ“
                                    </button>
                                    <div class="char-counter">
                                        <span id="charCount">0</span>/10000
                                    </div>
                                </div>
                                
                                <input 
                                    type="file" 
                                    id="fileInput" 
                                    class="hidden-file-input" 
                                    accept=".txt,.md"
                                    multiple
                                >
                            </div>
                            <button type="submit" class="send-btn" id="sendBtn">å‘é€</button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- å¯æ‹–æ‹½åˆ†éš”æ¡ -->
            <div class="resize-handle">
                <div class="resize-handle-line"></div>
            </div>

            <!-- å³ä¾¥ï¼šåˆ†ææˆæœåŒºåŸŸ -->
            <div class="analysis-panel">
                <div class="consensus-container">
                    <div class="consensus-header">
                        <div class="consensus-title">åˆ†ææˆæœ</div>
                    </div>
                    
                    <div class="consensus-content" id="consensusContent">
                        <div class="empty-state">
                            å¼€å§‹ä¸AIåŠ©æ‰‹å¯¹è¯åï¼Œè¿™é‡Œå°†å®æ—¶æ˜¾ç¤ºç»“æ„åŒ–çš„åˆ†ææˆæœ
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- åŠŸèƒ½è¯´æ˜ -->
        <div class="features-section">
            <div class="features-title">åŠŸèƒ½ç‰¹æ€§</div>
            
            <div class="feature-list">
                <div class="feature-item">
                    <div class="feature-icon">ğŸ“</div>
                    <div class="feature-content">
                        <div class="feature-name">ç‚¹å‡»ä¸Šä¼ </div>
                        <div class="feature-desc">ç‚¹å‡»ä¸Šä¼ æŒ‰é’®é€‰æ‹©æœ¬åœ°æ–‡ä»¶ï¼Œæ”¯æŒå¤šæ–‡ä»¶åŒæ—¶é€‰æ‹©</div>
                    </div>
                </div>
                
                <div class="feature-item">
                    <div class="feature-icon">ğŸ–±</div>
                    <div class="feature-content">
                        <div class="feature-name">æ‹–æ‹½ä¸Šä¼ </div>
                        <div class="feature-desc">ç›´æ¥å°†æ–‡ä»¶æ‹–æ‹½åˆ°è¾“å…¥æ¡†åŒºåŸŸå³å¯å¿«é€Ÿä¸Šä¼ </div>
                    </div>
                </div>
                
                <div class="feature-item">
                    <div class="feature-icon">ğŸ“Š</div>
                    <div class="feature-content">
                        <div class="feature-name">è¿›åº¦æ˜¾ç¤º</div>
                        <div class="feature-desc">å®æ—¶æ˜¾ç¤ºæ–‡ä»¶ä¸Šä¼ è¿›åº¦å’ŒçŠ¶æ€ï¼Œæ”¯æŒå–æ¶ˆä¸Šä¼ </div>
                    </div>
                </div>
                
                <div class="feature-item">
                    <div class="feature-icon">ğŸ“„</div>
                    <div class="feature-content">
                        <div class="feature-name">åŸæ–‡ä¼ é€’</div>
                        <div class="feature-desc">ä¸Šä¼ åçš„æ–‡ä»¶å†…å®¹å°†ä½œä¸ºå¯¹è¯èƒŒæ™¯ä¿¡æ¯ç›´æ¥ä¼ é€’ç»™AI</div>
                    </div>
                </div>
            </div>

            <div class="supported-formats">
                <div class="formats-title">æ”¯æŒçš„æ–‡ä»¶æ ¼å¼</div>
                <div class="formats-list">
                    <span class="format-tag">.txt</span>
                    <span class="format-tag">.md</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let attachedFiles = [];
        let dragCounter = 0;
        
        // ç¡®ä¿å…¨å±€è®¿é—®
        window.attachedFiles = attachedFiles;

        // æ–‡ä»¶å¤§å°æ ¼å¼åŒ–
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // è·å–æ–‡ä»¶å›¾æ ‡
        function getFileIcon(fileName) {
            const ext = fileName.split('.').pop().toLowerCase();
            const iconMap = {
                'txt': 'ğŸ“„',
                'md': 'ğŸ“'
            };
            return iconMap[ext] || 'ğŸ“„';
        }

        // è§¦å‘æ–‡ä»¶é€‰æ‹©
        function triggerFileUpload() {
            document.getElementById('fileInput').click();
        }

        // æ–‡ä»¶é€‰æ‹©å¤„ç†
        document.getElementById('fileInput').addEventListener('change', function(e) {
            handleFiles(e.target.files);
        });

        // å¤„ç†æ–‡ä»¶
        function handleFiles(files) {
            console.log('handleFilesè¢«è°ƒç”¨ï¼Œæ–‡ä»¶æ•°é‡:', files.length);
            Array.from(files).forEach(file => {
                console.log('å¤„ç†æ–‡ä»¶:', file.name);
                // éªŒè¯æ–‡ä»¶æ ¼å¼
                const ext = file.name.split('.').pop().toLowerCase();
                if (!['txt', 'md'].includes(ext)) {
                    alert(`ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼: ${ext}ã€‚ä»…æ”¯æŒ txt å’Œ md æ–‡ä»¶ã€‚`);
                    return;
                }
                
                if (attachedFiles.find(f => f.name === file.name)) {
                    alert(`æ–‡ä»¶ "${file.name}" å·²å­˜åœ¨ï¼`);
                    return;
                }

                const fileObj = {
                    id: Date.now() + Math.random(),
                    name: file.name,
                    size: file.size,
                    file: file,
                    uploaded: false
                };

                console.log('åˆ›å»ºæ–‡ä»¶å¯¹è±¡:', fileObj);
                attachedFiles.push(fileObj);
                window.attachedFiles = attachedFiles; // æ›´æ–°å…¨å±€å¼•ç”¨
                addAttachmentToPreview(fileObj);
                simulateUpload(fileObj);
            });

            updateAttachmentPreview();
        }
        
        // ç¡®ä¿å…¨å±€è®¿é—®
        window.handleFiles = handleFiles;

        // æ·»åŠ é™„ä»¶åˆ°é¢„è§ˆåŒºåŸŸ
        function addAttachmentToPreview(fileObj) {
            const attachmentList = document.getElementById('attachmentList');
            const attachmentItem = document.createElement('div');
            attachmentItem.className = 'attachment-item';
            attachmentItem.id = `attachment-${fileObj.id}`;
            
            attachmentItem.innerHTML = `
                <div class="attachment-icon">${getFileIcon(fileObj.name)}</div>
                <div class="attachment-info">
                    <div class="attachment-name">${fileObj.name}</div>
                    <div class="attachment-size">${formatFileSize(fileObj.size)}</div>
                </div>
                <button class="remove-attachment" onclick="removeAttachment('${fileObj.id}')" title="ç§»é™¤é™„ä»¶">
                    âœ•
                </button>
            `;

            attachmentList.appendChild(attachmentItem);
        }

        // ç§»é™¤é™„ä»¶
        function removeAttachment(fileId) {
            attachedFiles = attachedFiles.filter(f => f.id != fileId);
            document.getElementById(`attachment-${fileId}`).remove();
            updateAttachmentPreview();
        }

        // æ›´æ–°é™„ä»¶é¢„è§ˆåŒºåŸŸæ˜¾ç¤º
        function updateAttachmentPreview() {
            const preview = document.getElementById('attachmentPreview');
            if (attachedFiles.length > 0) {
                preview.classList.add('visible');
            } else {
                preview.classList.remove('visible');
            }
        }

        // æ¨¡æ‹Ÿæ–‡ä»¶ä¸Šä¼ 
        function simulateUpload(fileObj) {
            console.log('å¼€å§‹æ¨¡æ‹Ÿä¸Šä¼ :', fileObj.name);
            // åœ¨æ¶ˆæ¯ä¸­æ˜¾ç¤ºä¸Šä¼ è¿›åº¦
            addUploadProgressMessage(fileObj);
            
            let progress = 0;
            const progressInterval = setInterval(() => {
                progress += Math.random() * 20;
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(progressInterval);
                    fileObj.uploaded = true;
                    updateUploadProgress(fileObj.id, progress, 'ä¸Šä¼ å®Œæˆ');
                    console.log('æ–‡ä»¶ä¸Šä¼ å®Œæˆ:', fileObj.name);
                    
                    // 1ç§’åç§»é™¤è¿›åº¦æ¡
                    setTimeout(() => {
                        removeUploadProgress(fileObj.id);
                    }, 1000);
                } else {
                    updateUploadProgress(fileObj.id, progress, 'ä¸Šä¼ ä¸­...');
                }
            }, 200);
        }
        
        // ç¡®ä¿å…¨å±€è®¿é—®
        window.simulateUpload = simulateUpload;

        // æ·»åŠ ä¸Šä¼ è¿›åº¦æ¶ˆæ¯
        function addUploadProgressMessage(fileObj) {
            const messagesArea = document.getElementById('messagesArea');
            const messageEl = document.createElement('div');
            messageEl.className = 'message user';
            messageEl.id = `upload-message-${fileObj.id}`;
            
            messageEl.innerHTML = `
                <div class="message-avatar">ä½ </div>
                <div class="message-content">
                    æ­£åœ¨ä¸Šä¼ æ–‡ä»¶...
                    <div class="upload-progress" id="upload-progress-${fileObj.id}">
                        <div class="upload-progress-header">
                            <div class="upload-filename">${fileObj.name}</div>
                            <div class="upload-status">0%</div>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
                <div class="message-time">${new Date().toLocaleTimeString('zh-CN', {hour: '2-digit', minute: '2-digit'})}</div>
            `;
            
            messagesArea.appendChild(messageEl);
            scrollToBottom();
        }

        // æ›´æ–°ä¸Šä¼ è¿›åº¦
        function updateUploadProgress(fileId, progress, status) {
            const progressElement = document.getElementById(`upload-progress-${fileId}`);
            if (progressElement) {
                const statusElement = progressElement.querySelector('.upload-status');
                const fillElement = progressElement.querySelector('.progress-fill');
                
                statusElement.textContent = `${Math.round(progress)}%`;
                fillElement.style.width = `${progress}%`;
                
                if (progress >= 100) {
                    statusElement.textContent = status;
                }
            }
        }

        // ç§»é™¤ä¸Šä¼ è¿›åº¦æ˜¾ç¤º
        function removeUploadProgress(fileId) {
            const messageElement = document.getElementById(`upload-message-${fileId}`);
            if (messageElement) {
                messageElement.remove();
            }
        }

        // æ‹–æ‹½äº‹ä»¶å¤„ç†  
        const inputWrapper = document.querySelector('.input-area');
        const dragOverlay = document.getElementById('dragOverlay');
        const messageInput = document.getElementById('messageInput');

        // é˜²æ­¢é»˜è®¤æ‹–æ‹½è¡Œä¸º
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            inputWrapper.addEventListener(eventName, preventDefaults, false);
            document.body.addEventListener(eventName, preventDefaults, false);
        });
        
        console.log('æ‹–æ‹½äº‹ä»¶ç›‘å¬å™¨å·²è®¾ç½®');
        console.log('inputWrapper:', inputWrapper);
        console.log('dragOverlay:', dragOverlay);

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        // æ‹–æ‹½è¿›å…¥
        ['dragenter', 'dragover'].forEach(eventName => {
            inputWrapper.addEventListener(eventName, handleDragIn, false);
        });

        function handleDragIn(e) {
            dragCounter++;
            dragOverlay.classList.add('active');
            messageInput.classList.add('drag-over');
        }

        // æ‹–æ‹½ç¦»å¼€
        ['dragleave'].forEach(eventName => {
            inputWrapper.addEventListener(eventName, handleDragOut, false);
        });

        function handleDragOut(e) {
            dragCounter--;
            if (dragCounter === 0) {
                dragOverlay.classList.remove('active');
                messageInput.classList.remove('drag-over');
            }
        }

        // æ–‡ä»¶æ”¾ä¸‹
        inputWrapper.addEventListener('drop', handleDrop, false);

        function handleDrop(e) {
            dragCounter = 0;
            dragOverlay.classList.remove('active');
            messageInput.classList.remove('drag-over');
            
            const files = e.dataTransfer.files;
            handleFiles(files);
        }

        // å‘é€æ¶ˆæ¯
        function sendMessage(event) {
            if (event) {
                event.preventDefault();
            }
            
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message && attachedFiles.length === 0) {
                return;
            }

            // æ£€æŸ¥æ˜¯å¦æœ‰æœªå®Œæˆä¸Šä¼ çš„æ–‡ä»¶
            const uploadingFiles = attachedFiles.filter(f => !f.uploaded);
            if (uploadingFiles.length > 0) {
                alert('è¯·ç­‰å¾…æ–‡ä»¶ä¸Šä¼ å®Œæˆåå†å‘é€æ¶ˆæ¯');
                return;
            }

            // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
            addUserMessage(message, attachedFiles);
            
            // æ¨¡æ‹ŸAIå›å¤
            setTimeout(() => {
                addAIResponse(message, attachedFiles);
            }, 1000);

            // æ¸…ç©ºè¾“å…¥å’Œé™„ä»¶
            input.value = '';
            input.style.height = 'auto';
            attachedFiles = [];
            document.getElementById('attachmentList').innerHTML = '';
            document.getElementById('charCount').textContent = '0';
            updateAttachmentPreview();
        }

        // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
        function addUserMessage(message, files) {
            const messagesArea = document.getElementById('messagesArea');
            const messageEl = document.createElement('div');
            messageEl.className = 'message user';
            
            let fileAttachmentsHTML = '';
            if (files.length > 0) {
                fileAttachmentsHTML = `
                    <div class="file-attachments">
                        ${files.map(file => `
                            <div class="file-attachment">
                                <div class="file-icon">${getFileIcon(file.name)}</div>
                                <div class="file-name">${file.name}</div>
                                <div class="file-size">${formatFileSize(file.size)}</div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
            
            messageEl.innerHTML = `
                <div class="message-avatar">ä½ </div>
                <div class="message-content">
                    ${message || 'ä¸Šä¼ äº†æ–‡æ¡£æ–‡ä»¶'}
                    ${fileAttachmentsHTML}
                </div>
                <div class="message-time">${new Date().toLocaleTimeString('zh-CN', {hour: '2-digit', minute: '2-digit'})}</div>
            `;
            
            messagesArea.appendChild(messageEl);
            scrollToBottom();
        }

        // æ·»åŠ AIå›å¤
        function addAIResponse(userMessage, files) {
            const messagesArea = document.getElementById('messagesArea');
            const messageEl = document.createElement('div');
            messageEl.className = 'message assistant';
            
            let response = '';
            if (files.length > 0) {
                const fileNames = files.map(f => f.name).join('ã€');
                response = `æˆ‘å·²ç»æ”¶åˆ°æ‚¨ä¸Šä¼ çš„æ–‡æ¡£ï¼š${fileNames}ã€‚æ–‡ä»¶å†…å®¹å·²ä½œä¸ºæˆ‘ä»¬å¯¹è¯çš„èƒŒæ™¯ä¿¡æ¯ï¼Œæˆ‘ä¼šåŸºäºæ–‡æ¡£å†…å®¹ä¸ºæ‚¨æä¾›æ›´å‡†ç¡®çš„åˆ†æã€‚`;
                if (userMessage) {
                    response += `\n\nå…³äºæ‚¨çš„é—®é¢˜"${userMessage}"ï¼ŒåŸºäºä¸Šä¼ çš„æ–‡æ¡£å†…å®¹ï¼Œæˆ‘çš„å»ºè®®æ˜¯...`;
                }
            } else if (userMessage) {
                response = `æ”¶åˆ°æ‚¨çš„æ¶ˆæ¯ã€‚${userMessage}`;
            }
            
            messageEl.innerHTML = `
                <div class="message-avatar">A</div>
                <div class="message-content">
                    ${response}
                </div>
                <div class="message-time">${new Date().toLocaleTimeString('zh-CN', {hour: '2-digit', minute: '2-digit'})}</div>
            `;
            
            messagesArea.appendChild(messageEl);
            scrollToBottom();
        }

        // æ»šåŠ¨åˆ°åº•éƒ¨
        function scrollToBottom() {
            const messagesArea = document.getElementById('messagesArea');
            messagesArea.scrollTop = messagesArea.scrollHeight;
        }

        // è‡ªåŠ¨è°ƒæ•´è¾“å…¥æ¡†é«˜åº¦å’Œæ›´æ–°å­—ç¬¦è®¡æ•°
        document.getElementById('messageInput').addEventListener('input', function() {
            // è°ƒæ•´é«˜åº¦
            this.style.height = 'auto';
            this.style.height = Math.min(this.scrollHeight, 200) + 'px';
            
            // æ›´æ–°å­—ç¬¦è®¡æ•°
            const currentLength = this.value.length;
            const charCount = document.getElementById('charCount');
            charCount.textContent = currentLength;
            
            // æ ¹æ®å­—ç¬¦æ•°é‡æ·»åŠ æ ·å¼
            charCount.classList.remove('warning', 'danger');
            if (currentLength >= 10000) {
                charCount.classList.add('danger');
            } else if (currentLength >= 8000) {
                charCount.classList.add('warning');
            }
        });

        // æ”¯æŒShift+Enteræ¢è¡Œï¼ŒEnterå‘é€
        let isComposing = false;
        
        document.getElementById('messageInput').addEventListener('compositionstart', function() {
            isComposing = true;
        });
        
        document.getElementById('messageInput').addEventListener('compositionend', function() {
            isComposing = false;
        });
        
        document.getElementById('messageInput').addEventListener('keypress', function(e) {
            if (isComposing) return;
            
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                if (this.value.trim()) {
                    sendMessage();
                }
            }
        });
        
        // è¡¨å•æäº¤
        document.getElementById('messageForm').addEventListener('submit', sendMessage);
    </script>
</body>
</html>
