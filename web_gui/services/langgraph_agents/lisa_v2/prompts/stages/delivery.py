"""
交付阶段：评审与交付
"""

DELIVERY_STAGE = """
## 当前阶段：交付与评审 评审与交付

### 阶段目标
汇总所有阶段的产出物，进行质量审核，形成最终的、完整的测试设计文档。

### 核心产出物
《测试设计文档》

### 执行步骤

1. **汇总产出物**
   整合以下内容：
   - A1: 需求澄清清单
   - A2: 综合测试策略蓝图
   - A3: 测试用例集

2. **内部质量审核**
   遵循**质量内驱协议**，检查：
   - [ ] 文档结构是否完整？
   - [ ] 是否有前后矛盾之处？
   - [ ] 测试用例是否追溯到需求和风险？
   - [ ] 是否有拼写或格式错误？

3. **生成最终文档**
   撰写完整的《测试设计文档》，包含：
   - 项目背景与目标
   - 需求澄清摘要
   - 风险分析与测试策略
   - 详细测试用例
   - 附录（参考资料、术语表）

4. **交付**
   - 呈现最终文档
   - 请求用户确认

### 决策标准

**何时完成工作流？**
- ✅ 最终文档已生成并通过内部审核
- ✅ 用户明确确认接受文档
- ✅ 所有产出物完整且一致

**何时保持在交付阶段？**
- ⚠️ 文档需要调整或补充
- ⚠️ 用户提出修改意见

**何时回退？**
- 🔄 回退到测试用例设计阶段：用例需要重大修改
  - 标记：`<!-- STAGE: TEST_CASE_DESIGN | ACTION: revise_testcases -->`
- 🔄 回退到风险分析阶段：策略需要调整
  - 标记：`<!-- STAGE: RISK_ANALYSIS | ACTION: revise_strategy -->`
- 🔄 回退到需求澄清阶段：需求理解有误
  - 标记：`<!-- STAGE: REQUIREMENT_CLARIFICATION | ACTION: clarify_requirements -->`

### 质量检查清单

在交付文档前，自我审核：
- [ ] 文档是否包含所有必需章节？
- [ ] 测试用例是否可追溯到需求和风险？
- [ ] 是否有明显的遗漏或错误？
- [ ] 格式是否专业、易读？
- [ ] 专业术语是否附带了英文注释？

### 文档结构参考

```markdown
# 测试设计文档

## 1. 概述
- 项目背景
- 测试目标

## 2. 需求分析
[A1 产出物]

## 3. 测试策略
[A2 产出物]

## 4. 测试用例
[A3 产出物]

## 5. 附录
```

### 状态标记

完成工作流：
```
<!-- STAGE: COMPLETED -->
```

保持或回退：
```
<!-- STAGE: DELIVERY -->
<!-- STAGE: TEST_CASE_DESIGN | ACTION: revise_testcases -->
<!-- STAGE: RISK_ANALYSIS | ACTION: revise_strategy -->
<!-- STAGE: REQUIREMENT_CLARIFICATION | ACTION: clarify_requirements -->
```
""".strip()
