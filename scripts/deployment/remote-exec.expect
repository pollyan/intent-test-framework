#!/usr/bin/expect -f
# SSH远程执行脚本

set timeout 900
set server "120.53.220.231"
set user "ubuntu"
set password "Shunlian04"
set command [lindex $argv 0]

# 禁用远程PTY分配，避免服务器上PTY不足导致连接失败
spawn ssh -T -o StrictHostKeyChecking=no -o ConnectTimeout=30 ${user}@${server} ${command}

expect {
    "password:" {
        send "${password}\r"
        exp_continue
    }
    timeout {
        puts "Connection timeout"
        exit 1
    }
    eof
}

catch wait result
exit [lindex $result 3]


