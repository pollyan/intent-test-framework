[pytest]
# Pytest配置文件 - 专门为API测试优化

# 测试发现
testpaths = tests/api tests/proxy
python_files = test_*.py *_test.py
python_classes = Test*
python_functions = test_*

# 并行执行配置
# 安装pytest-xdist后可启用: pip install pytest-xdist
# addopts = -n auto --dist worksteal

# 测试输出配置
addopts = 
    --verbose
    --tb=short
    --strict-markers
    --strict-config
    --disable-warnings
    --maxfail=10
    --durations=10

# 标记定义
markers =
    api: API集成测试
    slow: 慢速测试（执行时间>5秒）
    fast: 快速测试（执行时间<1秒）
    integration: 集成测试
    unit: 单元测试（已移除，保留标记避免错误）
    smoke: 冒烟测试
    regression: 回归测试
    security: 安全测试
    performance: 性能测试
    error: 错误场景测试
    midscene: MidScene微服务测试
    database: 数据库相关测试
    mock: 使用Mock的测试
    network: 需要网络访问的测试
    
# 最小Python版本
minversion = 3.8

# 过滤警告
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    ignore::urllib3.exceptions.InsecureRequestWarning
    # Flask相关警告
    ignore:.*Flask.*:DeprecationWarning
    # SQLAlchemy相关警告
    ignore:.*SQLAlchemy.*:DeprecationWarning
    
# 日志配置
log_cli = false
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] %(name)s: %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

# 测试数据库配置 - 使用环境变量在测试中设置

# JUnit XML报告输出（CI/CD集成）
junit_family = xunit2
junit_logging = all
junit_log_passing_tests = true

# 并行测试优化配置
# 启用方式: pytest -n auto（需要pytest-xdist）
# 或在CI中使用: pytest -n 4 --dist worksteal